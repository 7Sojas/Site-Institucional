<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - 7SOJAS</title>
    <link rel="stylesheet" href="css/style.css">

    <link rel="icon" type="image/png" href="../img_one_page/img_calculadora/soja.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
</head>

<body>
        <div class="container">

            <img src="./src/logoNavbar.png" alt="">


            <ul class="nav-bar">
               
            </ul>
        </div>



        <div class="caixa-cadastro-maior">

            <div> <img src="./src/Enter-OTP-rafiki.webp" alt=""></div>


            <div class="caixa-cadastro">
                <center>
                    <h1> Criar uma conta</h1>
                    <h3>vamos começar!</h3>
                    <br>
                    Nome completo: <br>
                    <input type="text" id="input_nome">
                    <br><br>
                    E-mail: <br>
                    <input type="text" id="input_email">
                    <br><br>
                    Informe seu CPF: <br>
                    <input type="text" id="input_cpf">
                    <br><br>
                    Crie uma senha: <br>
                    <input type="password" id="input_senha" onkeyup="instrucaoSenha()">
                    <br><br>
                    Confirme sua senha: <br>
                    <input type="password" id="input_confirmarSenha">
                    <br><br>
                    <button onclick="realizarCadastro()"><b>CADASTRAR</b></button>
                    <br>
                    <div class="alerta_erro">
                      <div class="card_erro" id="cardErro">
                          <span id="mensagem_erro"></span>
                      </div>
                  </div>
                    <p id="p_instrucao">Senha deve conter primeira letra maiúscula, 123 e algum caractere especial entre
                        @, # ou *
                    </p>

                    <p>Já possui uma conta? Realize o <a href="login.html">Login</a></p>
                </center>
            </div>


</body>

</html>

<script  src="//code.jivosite.com/widget/q3hkbM54dw" async></script>

<script>
    function realizarCadastro() {
      //aguardar();
  
      //Recupere o valor da nova input pelo nome do id
      // Agora vá para o método fetch logo abaixo
      var nomeVar = input_nome.value;
      var emailVar = input_email.value;
      var senhaVar = input_senha.value;
      var confirmacaoSenhaVar = input_confirmarSenha.value;
      var cpfVar = input_cpf.value
        if(cpfVar.length >= 12 || cpfVar.length < 11){
        alert("O campo CPF precisa ter 11 Números")
      }
      if (
        nomeVar == "" ||
        emailVar == "" ||
        senhaVar == "" ||
        confirmacaoSenhaVar == "" ||
        cpfVar == ""
      ) {
        cardErro.style.display = "block"
            mensagem_erro.innerHTML = "Preencha todos os campos para continuar!";
            return false;
      }
        if (!nomeVar.match(/^[A-Z][a-z]+(\s[A-Z][a-z]+)?$/)) {
            alert('O nome deve começar com letra maiúscula e conter pelo menos um sobrenome.');
            return;
        } else {
            if (nomeVar.length < 2) {
                alert('O nome deve ter pelo menos 5 caracteres.');
                return;
            }
        }

        if (!emailVar.includes('@')) {
            alert('O e-mail deve conter o caractere "@".');
            return;
        }

        if (!senhaVar.match(/^[A-Z][A-Za-z0-9#*@]+[0-9]+[A-Za-z0-9#*@]+$/)) {
            alert('A senha deve começar com letra maiúscula, conter um número de 0 à 9 e incluir um caractere especial entre "@", "#" ou "*".');
            return;
        } else {
            if (senhaVar.length < 8) {
                alert('A senha deve ter pelo menos 8 caracteres.');
                return;
            }
        }

        if (senhaVar !== confirmacaoSenhaVar) {
            alert('A confirmação de senha não corresponde à senha digitada.');
            return;
        }
      // Enviando o valor da nova input
      fetch("/usuarios/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json; charset=UTF-8",
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          // Agora vá para o arquivo routes/usuario.js
          nomeServer: nomeVar,
          emailServer: emailVar,
          senhaServer: senhaVar,
          cpfServer: cpfVar
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);
  
          if (resposta.ok) {

  
            setTimeout(() => {
              window.location = "login.html";
            }, "2000");
  
            limparFormulario();
            //finalizarAguardar();
          } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
          //finalizarAguardar();
        });
  
      return false;
    }
  
    function listar() {
      fetch("/empresas/listar", {
        method: "GET",
      })
        .then(function (resposta) {
          resposta.json().then((usuario) => {
            empresas.forEach((usuario) => {
              listaEmpresas.innerHTML += `<option value='${usuario.id}'>${usuario.cpf}</option>`;
            });
          });
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
        });
    }
  
    function sumirMensagem() {
        cardErro.style.display = "none"
    }
  
    function instrucaoSenha(){
      p_instrucao.style.display = "block";
    }
  
    
  </script>
