<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="estiloTelaPropriedade.css">
    <link rel="icon" type="image/png" href="../img_one_page/img_calculadora/soja.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap"
        rel="stylesheet">
    <title>Dashboard - HOME</title>
</head>

<body onload="carregarPropriedades()">
    <div class="bolha"></div>
    <div class="bolha2"></div>

    <aside class="menu">

        <img src="src/logo.png" alt="Logo 7sojas">

        <nav>
            <ul>
                <li><a style="color: #5cff95;" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-list">
                            <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
                            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                            <path d="M12 11h4" />
                            <path d="M12 16h4" />
                            <path d="M8 11h.01" />
                            <path d="M8 16h.01" />

                        </svg> <span>DASHBOARD</span></a></li>
                        

            </ul>

            <ul>
                <li><a href="mailto:7sojas@gmail.com"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"
                            stroke-linejoin="round" class="lucide lucide-heart-handshake">
                            <path
                                d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                            <path
                                d="M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08v0c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.79 0l2.96 2.66" />
                            <path d="m18 15-2-2" />
                            <path d="m15 18-2-2" />
                        </svg><span>AJUDA</span></a></li>
                <li onclick="logout()"><span id="logout"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"
                            stroke-linejoin="round" class="lucide lucide-log-out">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                            <polyline points="16 17 21 12 16 7" />
                            <line x1="21" x2="9" y1="12" y2="12" />
                        </svg><span>SAIR</span></span></li>
            </ul>

            <div>

                <a href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-user">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                    <span id="nomeUsuario"></span>
                </a>
            </div>
        </nav>

    </aside>

    <main>

        <div>

            <svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" viewBox="0 0 24 24" fill="none"
                stroke="#ffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-clipboard-list">
                <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                <path d="M12 11h4" />
                <path d="M12 16h4" />
                <path d="M8 11h.01" />
                <path d="M8 16h.01" />
                <h1>DASHBOARD</h1>
        </div>

        <div>
            <svg class="search" mlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none"
                stroke="#fffc" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-search">
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.3-4.3" />
            </svg>

            <input placeholder="Pesquisar propriedade.." id="iptSearch" onkeyup="pesquisarPropriedade()"
                type="search" />
        </div>

        <div class="kpi-content kpi-index">
            <div class="kpi-graficos-cards" style="width: 350px;">
                <div>
                    <h3>Média propriedades em alerta</h3>
                </div>
                <p id="qtd_propriedade">0%</p>
            </div>
            <div class="kpi-graficos-cards">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="orange" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-circle-alert">
                        <circle cx="12" cy="12" r="10" />
                        <line x1="12" x2="12" y1="8" y2="12" />
                        <line x1="12" x2="12.01" y1="16" y2="16" />
                    </svg>
                    <h3>Propriedades em alerta</h3>
                </div>
                <p> <span id="span_propriedadeAlerta">0</span>/<span class="qtd_propriedades"></span></p>

            </div>
        </div>
        <h2>PROPRIEDADES</h2>

        <div id="warning">
            <h3>Você ainda não cadastrou nenhuma propriedade.</h3>
        </div>

        <div class="card-content" id="propriedades-container">
            <!-- As propriedades serão carregadas aqui -->
        </div>

</body>

</html>

<script src="//code.jivosite.com/widget/q3hkbM54dw" async></script>

<script>

    function carregarPropriedades() {

        const idUsuario = sessionStorage.ID_USUARIO
        const nome = sessionStorage.NOME_USUARIO

        nomeUsuario.innerHTML = nome
        console.log(idUsuario)

        fetch(`/propriedade/${idUsuario}/propriedades`)
            .then(data => data.json())
            .then(response => {


                let propriedadeAlerta = 0;

                const container = document.getElementById('propriedades-container');
                container.innerHTML = '';



                document.querySelectorAll('.qtd_propriedades')[0].innerHTML = response.length

                if (response.length > 0) {

                    response.forEach(item => {


                        let alerta = 0;

                        fetch(`/propriedade/${item.id}/alerta`)
                            .then(resposta => resposta.json())
                            .then(data => {
                                if (data[0] == undefined) {

                                    const card = document.createElement('a');
                                    card.href = `index.html?id=${item.id}`;
                                    card.innerHTML = `
                                <div class="card">
                                    <img src="src/farm.png" alt="">
                                    <li>
                                        <h3> ${item.nome}</h3>
                                    </li>
                                </div>
                        `;
                                    container.appendChild(card);

                                }

                                if (data[0].PROPRIEDADE != undefined) {
                                    const card = document.createElement('a');
                                    card.href = `index.html?id=${item.id}`;
                                    card.innerHTML = `
                                <div class="card">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    stroke="orange" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                    class="lucide lucide-circle-alert">
                                    <circle cx="12" cy="12" r="10" />
                                    <line x1="12" x2="12" y1="8" y2="12" />
                                    <line x1="12" x2="12.01" y1="16" y2="16" />
                                </svg>
                                
                                <img src="src/farm.png" alt="">
                                    <li>
                                        <h3>${item.nome}</h3>
                                    </li>
                                </div>
                        `;
                                    container.appendChild(card);

                                    alerta++


                                    const porcentagem = (alerta / response.length) * 100
                                    qtd_propriedade.innerHTML = porcentagem.toFixed(0) + '%'
                                }

                                span_propriedadeAlerta.innerHTML = alerta

                            })

                    })

                } else {
                    warning.style.display = "flex"
                }

            })
    }


    function logout() {
        sessionStorage.clear()

        window.location = '../index.html'
    }

</script>